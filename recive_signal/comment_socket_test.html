<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Comment Notification</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        #log { border: 1px solid #ccc; padding: 10px; max-height: 300px; overflow-y: auto; }
        #log div { margin-bottom: 10px; }
    </style>
</head>
<body>
    <h2>Comment Notification WebSocket</h2>

    <label>User ID:</label>
    <input type="number" id="userId" value="1" min="1">
    <button onclick="connect()">Connect</button>

    <h3>Status: <span id="status">Disconnected</span></h3>

    <div id="log"></div>

    <script>
        let socket;

        function logMessage(message, type = "info") {
            const log = document.getElementById("log");
            const div = document.createElement("div");
            div.textContent = `[${type.toUpperCase()}] ${message}`;
            log.appendChild(div);
        }

        function connect() {
            const userId = document.getElementById("userId").value;
            const wsUrl = `ws://localhost:8000/ws/comments/${userId}/`;

            if (socket) socket.close();

            socket = new WebSocket(wsUrl);

            socket.onopen = () => {
                document.getElementById("status").textContent = "Connected";
                logMessage("WebSocket connected");
            };

            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                logMessage("New comment notification received:");
                logMessage(JSON.stringify(data, null, 2), "data");
            };

            socket.onclose = (event) => {
                document.getElementById("status").textContent = "Disconnected";
                logMessage(`WebSocket closed with code ${event.code}`, "warn");
            };

            socket.onerror = (error) => {
                logMessage("WebSocket error", "error");
            };
        }
    </script>
</body>
</html>
