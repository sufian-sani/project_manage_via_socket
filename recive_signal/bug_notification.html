<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Connect as User</title>
</head>
<body>
    <h2>WebSocket Notification</h2>

    <label for="userIdInput">Enter your User ID:</label>
    <input type="text" id="userIdInput" placeholder="e.g., 123">
    <button id="connectBtn">Connect</button>

    <h3>Notifications:</h3>
    <div id="notifications"></div>

    <script>
        let socket;

        document.getElementById('connectBtn').addEventListener('click', function () {
            const userId = document.getElementById('userIdInput').value.trim();

            if (!userId) {
                alert("Please enter a User ID.");
                return;
            }

            if (socket) {
                socket.close(); // Close any existing connection
            }

            socket = new WebSocket(`ws://localhost:8000/ws/bugs/user/?user_id=${userId}`);

            socket.onopen = function () {
                console.log(`WebSocket connected for user ID: ${userId}`);
            };

            socket.onmessage = function (event) {
                const data = JSON.parse(event.data);
                console.log("Message received:", data);

                const notifDiv = document.getElementById("notifications");
                const messageEl = document.createElement("p");
                messageEl.textContent = `ðŸ”” ${JSON.stringify(data)}`;
                notifDiv.appendChild(messageEl);
            };

            socket.onerror = function (error) {
                console.error("WebSocket error:", error);
            };

            socket.onclose = function (event) {
                console.warn("WebSocket closed:", event);
            };
        });
    </script>
</body>
</html>
